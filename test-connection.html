<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appwrite Connection Test</title>
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #121212;
            color: #fff;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .success { background: #1e4620; }
        .error { background: #4a1515; }
        .info { background: #1a3a5c; }
        button {
            background: #E50914;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        code {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
        }
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Appwrite Connection Test</h1>
    
    <div class="status info">
        <strong>Configuration:</strong><br>
        Endpoint: <code>https://cloud.appwrite.io/v1</code><br>
        Project ID: <code>69921d010019e2d80f37</code><br>
        Database ID: <code>69926a04003e2dda63d6</code>
    </div>

    <button onclick="testConnection()">üîç Test Connection</button>
    <button onclick="testMovies()">üé¨ Test Movies Collection</button>
    <button onclick="testConfig()">‚öôÔ∏è Test Config Collection</button>
    <button onclick="addTestMovie()">‚ûï Add Test Movie</button>

    <div id="results"></div>

    <script>
        const client = new Appwrite.Client();
        const databases = new Appwrite.Databases(client);

        client
            .setEndpoint('https://cloud.appwrite.io/v1')
            .setProject('69921d010019e2d80f37');

        const databaseId = '69926a04003e2dda63d6';

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            document.getElementById('results').prepend(div);
        }

        async function testConnection() {
            log('Testing connection...', 'info');
            try {
                // Just try to reach the endpoint
                const response = await fetch('https://cloud.appwrite.io/v1/health');
                if (response.ok) {
                    log('‚úÖ Appwrite endpoint is reachable!', 'success');
                } else {
                    log('‚ö†Ô∏è Endpoint responded with: ' + response.status, 'error');
                }
            } catch (error) {
                log('‚ùå Connection failed: ' + error.message, 'error');
            }
        }

        async function testMovies() {
            log('Testing movies collection...', 'info');
            try {
                const response = await databases.listDocuments(
                    databaseId,
                    'movies',
                    [Appwrite.Query.limit(5)]
                );
                log(`‚úÖ Movies collection accessible! Found ${response.total} movies.`, 'success');
                if (response.documents.length > 0) {
                    log('<pre>' + JSON.stringify(response.documents[0], null, 2) + '</pre>', 'info');
                }
            } catch (error) {
                log(`‚ùå Movies collection error: ${error.message}<br><br>
                    <strong>Fix:</strong> Create collection with ID "movies" and set permissions to "Any" for Read`, 'error');
            }
        }

        async function testConfig() {
            log('Testing app_config collection...', 'info');
            try {
                const response = await databases.listDocuments(
                    databaseId,
                    'app_config',
                    [Appwrite.Query.limit(1)]
                );
                log(`‚úÖ Config collection accessible! Found ${response.total} documents.`, 'success');
            } catch (error) {
                log(`‚ùå Config collection error: ${error.message}<br><br>
                    <strong>Fix:</strong> Create collection with ID "app_config" and set permissions to "Any" for Read`, 'error');
            }
        }

        async function addTestMovie() {
            log('Adding test movie...', 'info');
            try {
                const movie = await databases.createDocument(
                    databaseId,
                    'movies',
                    Appwrite.ID.unique(),
                    {
                        title: 'Test Movie ' + Date.now(),
                        description: 'This is a test movie added to verify the connection.',
                        poster_url: 'https://via.placeholder.com/300x450/E50914/fff?text=Test+Movie',
                        year: 2024,
                        rating: 8.5,
                        download_480p: 'https://example.com/480p',
                        download_720p: 'https://example.com/720p',
                        download_1080p: 'https://example.com/1080p'
                    }
                );
                log('‚úÖ Test movie added successfully!<br>ID: <code>' + movie.$id + '</code>', 'success');
            } catch (error) {
                log(`‚ùå Failed to add movie: ${error.message}<br><br>
                    <strong>Fix:</strong> Make sure "movies" collection has Create permission for "Any"`, 'error');
            }
        }
    </script>
</body>
</html>
